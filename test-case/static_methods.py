"""
Python é™æ€æ–¹æ³•ï¼ˆ@staticmethodï¼‰å’Œç±»å±æ€§ï¼ˆclass attributeï¼‰çš„è¯¦ç»†è®²è§£

é™æ€æ–¹æ³•å’Œç±»å±æ€§æ˜¯ä¸ç±»ç›¸å…³è”ä½†ä¸éœ€è¦å®ä¾‹çš„æˆå‘˜ã€‚
"""

# ============================================================================
# 1. ç±»å±æ€§ vs å®ä¾‹å±æ€§
# ============================================================================

class Example1:
    """æ¼”ç¤ºç±»å±æ€§å’Œå®ä¾‹å±æ€§çš„åŒºåˆ«"""

    class_attr = "æˆ‘æ˜¯ç±»å±æ€§"  # ğŸ”µ ç±»å±æ€§ï¼šå±äºæ•´ä¸ªç±»ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«

    def __init__(self, name):
        self.instance_attr = name  # ğŸŸ¢ å®ä¾‹å±æ€§ï¼šå±äºæŸä¸ªå…·ä½“å®ä¾‹

    def show_both(self):
        print(f"ç±»å±æ€§: {self.class_attr}")
        print(f"å®ä¾‹å±æ€§: {self.instance_attr}")


print("=" * 70)
print("1. ç±»å±æ€§ vs å®ä¾‹å±æ€§")
print("=" * 70)

obj1 = Example1("å¯¹è±¡1")
obj2 = Example1("å¯¹è±¡2")

# è®¿é—®ç±»å±æ€§ï¼ˆä¸‰ç§æ–¹å¼ï¼‰
print(f"é€šè¿‡ç±»è®¿é—®: {Example1.class_attr}")  # âœ… æ¨è
print(f"é€šè¿‡å®ä¾‹1è®¿é—®: {obj1.class_attr}")   # âœ… å¯ä»¥ï¼Œä½†å®é™…ä¸Šè®¿é—®çš„æ˜¯ç±»å±æ€§
print(f"é€šè¿‡å®ä¾‹2è®¿é—®: {obj2.class_attr}")   # âœ… å¯ä»¥ï¼Œobj2 ä¹Ÿè®¿é—®åŒä¸€ä¸ªç±»å±æ€§

# è®¿é—®å®ä¾‹å±æ€§
print(f"obj1 çš„å®ä¾‹å±æ€§: {obj1.instance_attr}")  # å¯¹è±¡1
print(f"obj2 çš„å®ä¾‹å±æ€§: {obj2.instance_attr}")  # å¯¹è±¡2

obj1.show_both()
# è¾“å‡ºï¼šç±»å±æ€§: æˆ‘æ˜¯ç±»å±æ€§
#       å®ä¾‹å±æ€§: å¯¹è±¡1


# ============================================================================
# 2. ä¿®æ”¹ç±»å±æ€§ vs å®ä¾‹å±æ€§
# ============================================================================

class Example2:
    """æ¼”ç¤ºä¿®æ”¹ç±»å±æ€§å’Œå®ä¾‹å±æ€§çš„ä¸åŒæ•ˆæœ"""

    counter = 0  # ğŸ”µ ç±»å±æ€§ï¼šè®¡æ•°å™¨

    def __init__(self, name):
        self.name = name


print("\n" + "=" * 70)
print("2. ä¿®æ”¹ç±»å±æ€§ vs å®ä¾‹å±æ€§")
print("=" * 70)

obj3 = Example2("A")
obj4 = Example2("B")

print(f"åˆå§‹: Example2.counter = {Example2.counter}")

# âŒ é”™è¯¯çš„åšæ³•ï¼šé€šè¿‡å®ä¾‹ä¿®æ”¹ç±»å±æ€§
obj3.counter = 100  # è¿™å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹å±æ€§ï¼Œä¸æ˜¯ä¿®æ”¹ç±»å±æ€§ï¼
print(f"obj3.counter = {obj3.counter}")     # 100ï¼ˆæ˜¯ obj3 çš„å®ä¾‹å±æ€§ï¼‰
print(f"obj4.counter = {obj4.counter}")     # 0ï¼ˆobj4 è¿˜æ˜¯è®¿é—®ç±»å±æ€§ï¼‰
print(f"Example2.counter = {Example2.counter}")  # 0ï¼ˆç±»å±æ€§æœªæ”¹å˜ï¼‰

# âœ… æ­£ç¡®çš„åšæ³•ï¼šé€šè¿‡ç±»ä¿®æ”¹ç±»å±æ€§
Example2.counter = 50
print(f"ä¿®æ”¹å: Example2.counter = {Example2.counter}")
print(f"obj4.counter = {obj4.counter}")     # 50ï¼ˆç°åœ¨è®¿é—®ä¿®æ”¹åçš„ç±»å±æ€§ï¼‰

# åˆ é™¤ obj3 çš„å®ä¾‹å±æ€§ï¼Œæ¢å¤è®¿é—®ç±»å±æ€§
del obj3.counter
print(f"åˆ é™¤å: obj3.counter = {obj3.counter}")  # 50ï¼ˆè®¿é—®ç±»å±æ€§ï¼‰


# ============================================================================
# 3. å®é™…åº”ç”¨ï¼šä½¿ç”¨ç±»å±æ€§ä½œä¸ºè®¡æ•°å™¨
# ============================================================================

class Student:
    """å­¦ç”Ÿç±»ï¼Œä½¿ç”¨ç±»å±æ€§è®°å½•å­¦ç”Ÿæ€»æ•°"""

    total_students = 0  # ğŸ”µ ç±»å±æ€§ï¼šæ€»å­¦ç”Ÿæ•°

    def __init__(self, name):
        self.name = name  # ğŸŸ¢ å®ä¾‹å±æ€§
        Student.total_students += 1  # ä¿®æ”¹ç±»å±æ€§ï¼Œå¿…é¡»ç”¨ ClassName.attr

    @classmethod
    def get_total(cls):
        """è·å–å­¦ç”Ÿæ€»æ•°"""
        return cls.total_students



print("\n" + "=" * 70)
print("3. ç±»å±æ€§ä½œä¸ºè®¡æ•°å™¨")
print("=" * 70)

s1 = Student("Alice")
print(f"åˆ›å»º Alice åï¼Œæ€»äººæ•°: {Student.total_students}")

s2 = Student("Bob")
print(f"åˆ›å»º Bob åï¼Œæ€»äººæ•°: {Student.total_students}")

s3 = Student("Charlie")
print(f"åˆ›å»º Charlie åï¼Œæ€»äººæ•°: {Student.get_total()}")  # ä½¿ç”¨ classmethod


# ============================================================================
# 4. é™æ€æ–¹æ³• @staticmethod
# ============================================================================

class MathTools:
    """æ•°å­¦å·¥å…·ç±»ï¼Œä½¿ç”¨é™æ€æ–¹æ³•"""

    @staticmethod
    def add(a, b):
        """
        é™æ€æ–¹æ³•ï¼šä¸éœ€è¦ selfï¼ˆå®ä¾‹ï¼‰ä¹Ÿä¸éœ€è¦ clsï¼ˆç±»ï¼‰å‚æ•°ã€‚

        é™æ€æ–¹æ³•çš„ç‰¹ç‚¹ï¼š
        1. ä¸èƒ½è®¿é—®å®ä¾‹å±æ€§ï¼ˆæ²¡æœ‰ selfï¼‰
        2. ä¸èƒ½è®¿é—®ç±»å±æ€§ï¼ˆæ²¡æœ‰ clsï¼‰
        3. å°±åƒæ™®é€šå‡½æ•°ï¼Œåªæ˜¯é€»è¾‘ä¸Šå±äºæŸä¸ªç±»
        4. å¯ä»¥é€šè¿‡ç±»æˆ–å®ä¾‹è°ƒç”¨
        """
        return a + b

    @staticmethod
    def multiply(a, b):
        return a * b

    @staticmethod
    def is_even(num):
        """æ£€æŸ¥æ•°å­—æ˜¯å¦ä¸ºå¶æ•°"""
        return num % 2 == 0


print("\n" + "=" * 70)
print("4. é™æ€æ–¹æ³• @staticmethod")
print("=" * 70)

# é€šè¿‡ç±»è°ƒç”¨é™æ€æ–¹æ³•ï¼ˆæ¨èï¼‰
print(f"3 + 5 = {MathTools.add(3, 5)}")
print(f"3 Ã— 5 = {MathTools.multiply(3, 5)}")
print(f"10 æ˜¯å¶æ•°å—ï¼Ÿ{MathTools.is_even(10)}")

# é€šè¿‡å®ä¾‹è°ƒç”¨é™æ€æ–¹æ³•ï¼ˆå¯ä»¥ï¼Œä½†ä¸æ¨èï¼‰
calculator = MathTools()
print(f"é€šè¿‡å®ä¾‹è°ƒç”¨: {calculator.add(2, 8)}")


# ============================================================================
# 5. ç±»æ–¹æ³• @classmethod
# ============================================================================

class Config:
    """é…ç½®ç±»ï¼Œæ¼”ç¤º classmethod çš„ç”¨é€”"""

    debug_mode = False  # ğŸ”µ ç±»å±æ€§

    def __init__(self, name):
        self.__name = name

    @classmethod
    def enable_debug(cls):
        """é€šè¿‡ç±»æ–¹æ³•ä¿®æ”¹ç±»å±æ€§"""
        cls.debug_mode = True
        print("âœ… è°ƒè¯•æ¨¡å¼å·²å¯ç”¨")

    @classmethod
    def disable_debug(cls):
        """é€šè¿‡ç±»æ–¹æ³•ä¿®æ”¹ç±»å±æ€§"""
        cls.debug_mode = False
        print("âŒ è°ƒè¯•æ¨¡å¼å·²ç¦ç”¨")

    @classmethod
    def from_string(cls, config_string):
        """ä½¿ç”¨ classmethod ä½œä¸ºå¤‡é€‰æ„é€ å‡½æ•°"""
        name = config_string.split("=")[1]
        return cls(name)

    def show_status(self):
        print(f"é…ç½®åç§°: {self.__name}, è°ƒè¯•æ¨¡å¼: {Config.debug_mode}")

    def get_name(self) -> str:
        return self.__name


print("\n" + "=" * 70)
print("5. ç±»æ–¹æ³• @classmethod")
print("=" * 70)

conf1 = Config("ç”Ÿäº§ç¯å¢ƒ")
conf1.show_status()

Config.enable_debug()
conf1.show_status()

# ä½¿ç”¨ classmethod ä½œä¸ºå¤‡é€‰æ„é€ å‡½æ•°
conf2 = Config.from_string("name=æµ‹è¯•ç¯å¢ƒ")

print(conf2.get_name())
conf2.show_status()


# ============================================================================
# 6. å¯¹æ¯”ï¼š@staticmethod vs @classmethod vs æ™®é€šæ–¹æ³•
# ============================================================================

class Comparison:
    """å¯¹æ¯”ä¸‰ç§æ–¹æ³•çš„ä½¿ç”¨"""

    class_var = "ç±»å˜é‡"

    def __init__(self, instance_var):
        self.instance_var = instance_var

    def instance_method(self):
        """
        æ™®é€šæ–¹æ³•ï¼ˆinstance methodï¼‰
        - æœ‰ self å‚æ•°
        - å¯ä»¥è®¿é—®å®ä¾‹å±æ€§å’Œç±»å±æ€§
        - åªèƒ½é€šè¿‡å®ä¾‹è°ƒç”¨
        """
        return f"å®ä¾‹æ–¹æ³•: {self.instance_var}, {self.class_var}"

    @classmethod
    def class_method(cls):
        """
        ç±»æ–¹æ³•ï¼ˆclass methodï¼‰
        - æœ‰ cls å‚æ•°ï¼ˆä»£è¡¨ç±»æœ¬èº«ï¼Œä¸æ˜¯å®ä¾‹ï¼‰
        - å¯ä»¥è®¿é—®ç±»å±æ€§ï¼Œä½†ä¸èƒ½è®¿é—®å®ä¾‹å±æ€§
        - å¯ä»¥é€šè¿‡ç±»æˆ–å®ä¾‹è°ƒç”¨
        - å¸¸ç”¨äºå·¥å‚æ–¹æ³•ã€å¤‡é€‰æ„é€ å‡½æ•°
        """
        return f"ç±»æ–¹æ³•: {cls.class_var}"

    @staticmethod
    def static_method():
        """
        é™æ€æ–¹æ³•ï¼ˆstatic methodï¼‰
        - æ²¡æœ‰ self æˆ– cls å‚æ•°
        - æ—¢ä¸èƒ½è®¿é—®å®ä¾‹å±æ€§ä¹Ÿä¸èƒ½è®¿é—®ç±»å±æ€§
        - å°±åƒä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œåªæ˜¯ç»„ç»‡åœ¨ç±»é‡Œ
        - å¯ä»¥é€šè¿‡ç±»æˆ–å®ä¾‹è°ƒç”¨
        """
        return "é™æ€æ–¹æ³•: ä¸ç±»å’Œå®ä¾‹éƒ½æ— å…³"


print("\n" + "=" * 70)
print("6. å¯¹æ¯”ä¸‰ç§æ–¹æ³•")
print("=" * 70)

obj = Comparison("æˆ‘æ˜¯å®ä¾‹å˜é‡")

print(f"æ™®é€šæ–¹æ³•: {obj.instance_method()}")
print(f"ç±»æ–¹æ³•: {Comparison.class_method()}")
print(f"é™æ€æ–¹æ³•: {Comparison.static_method()}")

# éƒ½èƒ½é€šè¿‡å®ä¾‹è°ƒç”¨
print(f"\né€šè¿‡å®ä¾‹è°ƒç”¨ç±»æ–¹æ³•: {obj.class_method()}")
print(f"é€šè¿‡å®ä¾‹è°ƒç”¨é™æ€æ–¹æ³•: {obj.static_method()}")


# ============================================================================
# 7. å®é™…åº”ç”¨ï¼šå•ä¾‹æ¨¡å¼ï¼ˆä½¿ç”¨ classmethodï¼‰
# ============================================================================

class Singleton:
    """å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹"""

    _instance = None  # ğŸ”µ ç±»å±æ€§ï¼šä¿å­˜å”¯ä¸€å®ä¾‹

    def __init__(self, value):
        self.value = value

    @classmethod
    def get_instance(cls, value=None):
        """è·å–ï¼ˆæˆ–åˆ›å»ºï¼‰å”¯ä¸€å®ä¾‹"""
        if cls._instance is None:
            cls._instance = cls(value)
            print(f"âœ¨ åˆ›å»ºäº†æ–°å®ä¾‹: {cls._instance.value}")
        else:
            print(f"â™»ï¸  è¿”å›ç°æœ‰å®ä¾‹: {cls._instance.value}")
        return cls._instance


print("\n" + "=" * 70)
print("7. å®é™…åº”ç”¨ï¼šå•ä¾‹æ¨¡å¼")
print("=" * 70)

s1 = Singleton.get_instance("ç¬¬ä¸€ä¸ª")
s2 = Singleton.get_instance("ç¬¬äºŒä¸ª")
s3 = Singleton.get_instance("ç¬¬ä¸‰ä¸ª")

print(f"s1 is s2: {s1 is s2}")  # Trueï¼ˆéƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰


# ============================================================================
# 8. å®é™…åº”ç”¨ï¼šè®¡æ•°å™¨å·¥å‚ï¼ˆSequence ç±»çš„è®¾è®¡ï¼‰
# ============================================================================

class Sequence:
    """æ¨¡æ‹Ÿ nano-vllm ä¸­çš„ Sequence ç±»"""

    block_size = 256  # ğŸ”µ ç±»å±æ€§ï¼šæ‰€æœ‰å®ä¾‹å…±äº«çš„å—å¤§å°
    counter = 0       # ğŸ”µ ç±»å±æ€§ï¼šå…¨å±€è®¡æ•°å™¨

    def __init__(self, token_ids):
        """åˆå§‹åŒ–åºåˆ—"""
        Sequence.counter += 1  # å¿…é¡»é€šè¿‡ç±»åä¿®æ”¹ç±»å±æ€§
        self.seq_id = Sequence.counter
        self.token_ids = token_ids

    @classmethod
    def get_total_sequences(cls):
        """è·å–åˆ›å»ºçš„åºåˆ—æ€»æ•°"""
        return cls.counter

    @staticmethod
    def calculate_num_blocks(num_tokens, block_size=256):
        """è®¡ç®—æ‰€éœ€çš„å—æ•°ï¼ˆçº¯è®¡ç®—ï¼Œä¸ç±»æ— å…³ï¼‰"""
        return (num_tokens + block_size - 1) // block_size


print("\n" + "=" * 70)
print("8. å®é™…åº”ç”¨ï¼šSequence ç±»çš„è®¾è®¡")
print("=" * 70)

seq1 = Sequence([1, 2, 3])
print(f"åˆ›å»º seq1ï¼ŒID: {seq1.seq_id}")

seq2 = Sequence([4, 5, 6])
print(f"åˆ›å»º seq2ï¼ŒID: {seq2.seq_id}")

seq3 = Sequence([7, 8, 9])
print(f"åˆ›å»º seq3ï¼ŒID: {seq3.seq_id}")

print(f"æ€»åºåˆ—æ•°: {Sequence.get_total_sequences()}")
print(f"300 ä¸ª token éœ€è¦å¤šå°‘å—ï¼Ÿ{Sequence.calculate_num_blocks(300)}")
print(f"512 ä¸ª token éœ€è¦å¤šå°‘å—ï¼Ÿ{Sequence.calculate_num_blocks(512)}")


# ============================================================================
# 9. å¯¹æ¯”æ€»ç»“è¡¨
# ============================================================================

print("\n" + "=" * 70)
print("9. å¯¹æ¯”æ€»ç»“")
print("=" * 70)

summary = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç‰¹æ€§           â”‚   æ™®é€šæ–¹æ³•        â”‚   classmethod    â”‚   staticmethod   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¬¬ä¸€ä¸ªå‚æ•°          â”‚ self (å®ä¾‹)       â”‚ cls (ç±»)         â”‚ æ—                â”‚
â”‚ è®¿é—®å®ä¾‹å±æ€§        â”‚ âœ… å¯ä»¥          â”‚ âŒ ä¸èƒ½          â”‚ âŒ ä¸èƒ½          â”‚
â”‚ è®¿é—®ç±»å±æ€§          â”‚ âœ… å¯ä»¥          â”‚ âœ… å¯ä»¥          â”‚ âŒ ä¸èƒ½          â”‚
â”‚ é€šè¿‡å®ä¾‹è°ƒç”¨        â”‚ âœ… æ¨è          â”‚ âš ï¸  å¯ä»¥         â”‚ âš ï¸  å¯ä»¥         â”‚
â”‚ é€šè¿‡ç±»è°ƒç”¨          â”‚ âŒ ä¸èƒ½          â”‚ âœ… æ¨è          â”‚ âœ… æ¨è          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¸¸è§ç”¨é€”            â”‚ å¤„ç†å®ä¾‹æ•°æ®      â”‚ å¤‡é€‰æ„é€ å‡½æ•°     â”‚ å·¥å…·å‡½æ•°         â”‚
â”‚                     â”‚ ä¿®æ”¹å®ä¾‹çŠ¶æ€      â”‚ å·¥å‚æ–¹æ³•         â”‚ çº¯è®¡ç®—           â”‚
â”‚                     â”‚                  â”‚ ä¿®æ”¹ç±»çŠ¶æ€       â”‚ æ— å‰¯ä½œç”¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ ä½•æ—¶ä½¿ç”¨ï¼š
  - æ™®é€šæ–¹æ³•ï¼šéœ€è¦è®¿é—®å®ä¾‹æ•°æ®æ—¶
  - classmethodï¼šéœ€è¦è®¿é—®/ä¿®æ”¹ç±»æ•°æ®æ—¶ï¼Œæˆ–ä½œä¸ºå¤‡é€‰æ„é€ å‡½æ•°
  - staticmethodï¼šçº¯è®¡ç®—é€»è¾‘ï¼Œä¸ç±»å’Œå®ä¾‹éƒ½æ— å…³çš„å·¥å…·å‡½æ•°
"""

print(summary)


# ============================================================================
# 10. ä»£ç ç¤ºä¾‹æ€»ç»“
# ============================================================================

print("\n" + "=" * 70)
print("10. ä»£ç æ¨¡å¼æ€»ç»“")
print("=" * 70)

example_code = """
# ç±»å±æ€§çš„æ­£ç¡®ç”¨æ³•
class MyClass:
    class_attr = 100  # ç±»å±æ€§

    def __init__(self):
        self.instance_attr = 200  # å®ä¾‹å±æ€§

    # âœ… åœ¨æ™®é€šæ–¹æ³•ä¸­ä¿®æ”¹ç±»å±æ€§
    def increment_class_attr(self):
        MyClass.class_attr += 1  # å¿…é¡»ç”¨ç±»å

    # âœ… classmethod ç”¨äºä¿®æ”¹ç±»å±æ€§
    @classmethod
    def reset_class_attr(cls):
        cls.class_attr = 100

    # âœ… staticmethod ç”¨äºå·¥å…·å‡½æ•°
    @staticmethod
    def utility_function(x, y):
        return x + y

# ä½¿ç”¨
obj = MyClass()
MyClass.class_attr = 50          # âœ… é€šè¿‡ç±»ä¿®æ”¹
obj.increment_class_attr()        # âœ… é€šè¿‡æ–¹æ³•ä¿®æ”¹
MyClass.reset_class_attr()        # âœ… é€šè¿‡ classmethod é‡ç½®
result = MyClass.utility_function(1, 2)  # âœ… é€šè¿‡ç±»è°ƒç”¨é™æ€æ–¹æ³•
"""

print(example_code)

